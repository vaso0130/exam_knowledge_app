# 功能更新總結 - 個別題目心智圖與原始文件保存

## 🎯 新功能概覽

### 1. 個別題目心智圖
每個題目現在都有自己的專屬心智圖，幫助使用者思考相關問題和概念關聯。

#### 實現細節：
- **資料庫支援**：在 `questions` 表中添加 `mindmap_code` 欄位
- **AI 生成**：每生成一個題目後，立即為該題目創建專屬心智圖
- **前端顯示**：在題目詳情頁面顯示該題目的專屬心智圖
- **生成邏輯**：基於題目相關的知識點生成，比整體文件心智圖更精準

#### 檔案修改：
- `src/core/database.py`：新增 `update_question_mindmap()` 方法
- `src/flows/content_flow.py`：在題目處理流程中添加心智圖生成
- `src/webapp/templates/question_detail.html`：更新顯示邏輯

### 2. 原始文件保存功能
完整保存上傳文件的原始內容，方便使用者對照和驗證。

#### 實現細節：
- **資料庫支援**：在 `documents` 表中添加 `original_content` 欄位
- **儲存邏輯**：在文件處理過程中同時儲存原始內容和處理後內容
- **檢視功能**：提供專門的原始文件檢視頁面
- **連結整合**：從題目頁面可以直接連結到原始文件

#### 新增路由：
- `/document/<int:doc_id>`：文件詳情頁面
- `/original_document/<int:doc_id>`：原始文件檢視頁面
- `/api/questions`：API 端點，支援根據文件 ID 查詢相關題目

#### 新增模板：
- `document_detail.html`：文件詳情頁面
- `original_document.html`：原始文件檢視頁面

## 🔧 技術實現

### 資料庫變更
```sql
-- 題目表新增心智圖欄位
ALTER TABLE questions ADD COLUMN mindmap_code TEXT;

-- 文件表新增原始內容欄位
ALTER TABLE documents ADD COLUMN original_content TEXT;
```

### API 擴展
- 新增 `/api/questions` 端點，支援 AJAX 載入相關題目
- 支援根據 `document_id` 參數篩選題目

### 前端增強
- 題目詳情頁面顯示專屬心智圖
- 原始文件檢視頁面，支援 Markdown 渲染
- 動態載入相關題目列表

## 🎨 用戶體驗改進

### 1. 學習路徑優化
- **個別心智圖**：每個題目都有專屬的知識關聯圖
- **原始內容對照**：可以對照原始文件驗證 AI 生成內容的準確性
- **快速導航**：題目與原始文件之間的雙向連結

### 2. 視覺化改進
- 使用 Mermaid.js 渲染心智圖
- 響應式設計，支援各種螢幕尺寸
- 清晰的資訊架構和導航邏輯

## 📋 使用方式

### 檢視題目專屬心智圖
1. 進入任意題目詳情頁面
2. 向下滾動至「題目專屬心智圖」區段
3. 查看基於此題目知識點生成的關聯圖

### 檢視原始文件
1. 在題目詳情頁面，點擊「檢視原始文件」按鈕
2. 或在文件資訊區段點擊來源文件連結
3. 對照原始內容與 AI 生成的題目答案

## 🚀 後續擴展空間

### 1. 心智圖互動性
- 點擊節點跳轉到相關知識點
- 支援心智圖編輯和自訂

### 2. 多格式支援
- 支援更多文件格式（Word、PowerPoint 等）
- 圖片 OCR 識別優化

### 3. 學習追蹤
- 記錄學習進度
- 推薦相關題目

## 📊 系統架構

```
用戶上傳文件
     ↓
文件內容處理（file_processor.py）
     ↓
AI 分析分類（gemini_client.py）
     ↓
生成題目和答案（content_flow.py）
     ↓
為每題生成專屬心智圖
     ↓
儲存到資料庫（database.py）
     ↓
前端展示（Flask routes + Templates）
```

這次更新大幅提升了學習體驗，讓每個題目都有自己的知識架構圖，並且保留了原始文件內容，方便使用者進行對照學習！
